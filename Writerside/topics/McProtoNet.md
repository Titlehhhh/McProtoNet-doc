# McProtoNet

В этой библиотеке собраны самые основные классы, которые 
помогают работать с протоколом Minecraft.
Библиотека включает инструменты для чтения и записи пакетов, 
обработки сетевых потоков, а также шифрования и сжатия данных. 

## Работа с пакетами

В пространстве имен `McProtoNet.Net` расположены основные классы, 
которые обеспечивают работу с пакетами. Они читают и записывают
пакеты согласно [протоколу Minecraft](https://minecraft.wiki/w/Minecraft_Wiki:Projects/wiki.vg_merge/Protocol#Packet_format).

1. `MinecraftPacketReader`

Класс `MinecraftPacketReader` предназначен для чтения пакетов из любого потока, в том числе, сетевого.

Для этого есть метод `ReadNextPacketAsync`, который возвращает [](McProtoNet-Abstractions.md#inputpacket).

<code-block lang="C#" src="../code-samples/ReadPacketSample.cs"/>

2. `MinecraftPacketSender`

Этот класс занимается отправкой пакетов. Добиться этого можно с помощью метода `SendPacketAsync`,
который в качестве аргумента принимает `ReadOnlyMemory<byte>`. 

`ReadOnlyMemory<byte>` - это отправленный пакет, у которого первые байты это идентификатор, остальное - данные.

```C#
NetworkStream ns = new NetworkStream(socket);

MinecraftPacketSender sender = new MinecraftPacketSender();
sender.BaseStream = ns;
byte[] data = [0, 3, 4, 5, 6];
await sender.SendPacketAsync(data, cancellationToken: default(CancellationToken));
```

Также имеются методы расширения для [](McProtoNet-Abstractions.md#outputpacket). Это удобно, если
Вы отправляете пакет прямиком из `MinecraftPrimitiveWriter`.

### Сжатие

Оба, вышеупомянутых класса, позволяют включить сжатие.
Это достигается с помощью метода `SwitchCompression`, который принимает
в качестве аргумента число — порог сжатия.

Для повышения производительности при сжатии и 
декомпрессии пакетов используется библиотека [libdeflate](https://github.com/ebiggers/libdeflate).

## Криптография

Пространство имён `McProtoNet.Cryptography` содержит два класса для упрощения
работы с шифрованием:

1. `CryptoHandler`

Утилитарный класс, который предоставляет некоторые методы:

<deflist>
<def title="DecodeRSAPublicKey">
<p>

</p>
</def>
<def title="GenerateAESPrivateKey(string,string, byte[])">
<p>
Генерирует случайный 128-битный приватный ключ.
</p>
<p>
Параметры:
</p>
<p>
<b>serverID</b> - 
</p>
<p>
Возвращает <code>byte[]</code> - ключ.
</p>
</def>
<def title="GetServerHash">
<p>

</p>
</def>
</deflist>


## Класс `MinecraftClient`

Пространство имён `McProtoNet.Client` содержит класс `MinecraftClient`, 
который является основой для подключения клиента к серверу Minecraft.
Этот класс предоставляет базовый функционал, включая аутентификацию на сервере. 
Однако, после успешной аутентификации, когда клиент переходит в состояние _**Play**_, 
его задача сводится к чтению и отправке пакетов, не уточняя их типы или содержание.

Класс `MinecraftClient` не занимается конкретной обработкой пакетов протокола 
Minecraft — ему всё равно, какие именно пакеты передаются. 
Вместо этого, его роль заключается в том, чтобы просто получать и отправлять данные, 
а также обрабатывать их через другие классы, такие как `MinecraftPacketReader` и `MinecraftPacketSender`. 
Это позволяет централизовать логику обмена пакетами и обработку данных, 
оставляя `MinecraftClient` ответственным только за базовую работу с подключением и аутентификацией.

По сути, этот класс служит связующим звеном между клиентом и сервером, поддерживая соединение, 
обеспечивая механизмы для работы с пакетом и обрабатывая сетевые ошибки, но не 
углубляясь в детали обработки пакетов, что позволяет пользователям библиотеки 
строить на его основе более сложные решения.

Исходный код: [MinecraftClient.cs](https://github.com/Titlehhhh/McProtoNet/blob/dev/src/McProtoNet/Client/MinecraftClient.cs)

### Основные настройки

<deflist>
<def title="Host">
Хост (IP-адрес или доменное имя) сервера Minecraft для подключения.
</def>
<def title="Port">
Порт, используемый для подключения к серверу Minecraft. 
По умолчанию используется стандартный порт Minecraft — 25565.
</def>
<def title="Username">
Имя пользователя, которое будет использоваться для аутентификации на сервере.
</def>
<def title="Version">
Версия протокола Minecraft, с которой должен работать клиент. 
Этот параметр используется для обеспечения совместимости с различными версиями сервера.
</def>
<def title="Proxy?">
Прокси-сервер, через который будет осуществляться подключение. 
Если не указан, подключение происходит напрямую.
</def>
<def title="ConnectTimeout">
Таймаут подключения к серверу. 
Устанавливает максимальное время ожидания установления соединения.
</def>
<def title="ReadTimeout">
Таймаут чтения данных из сети, измеряется в миллисекундах. 
Этот параметр определяет, сколько времени клиент будет ожидать данные от сервера.
</def>
<def title="WriteTimeout">
Таймаут записи данных в сеть, измеряется в миллисекундах. 
Этот параметр определяет, сколько времени клиент будет ожидать успешную отправку данных на сервер.
</def>
</deflist>

